<div class="container mt-4">
  <!-- Header -->
  <div class="job-header text-center mb-4">
    <h2 class="job-title">
      <i class="pi pi-info-circle"></i> About Management
    </h2>
    <p class="job-subtitle">
      Edit the About page content, images and section titles
    </p>
  </div>

  <div class="card shadow-sm p-4">
    <form [formGroup]="aboutForm" (ngSubmit)="onSubmit()" class="dialog-form">
      <!-- Basic Information -->
      <details class="accordion-section" open>
        <summary class="accordion-header">Basic Information</summary>
        <div class="accordion-content">
          <div class="form-group full">
            <label>Main Content</label>
            <p-editor formControlName="content" [style]="{ height: '200px' }"
              placeholder="Enter main about us content here..."></p-editor>
          </div>

          <div class="form-group full">
            <label>Banner Image</label>
            <div class="banner-preview-wrapper">
              <input type="file" accept="image/*" (change)="onFileSelected($event, 'banner')" />
              <button type="button" pButton label="Clear" class="p-button-text p-button-sm mt-2"
                *ngIf="selectedImages['banner']" (click)="clearImage('banner')"></button>
              <small class="text-muted d-block">Recommended: 1920x720 px</small>
              <div *ngIf="
                  selectedImages['banner'] ||
                  aboutForm.get('bannerImage')?.value
                " class="preview-container mt-2">
                <img [src]="
                    imagePreviews['banner'] ||
                    buildImageUrl(aboutForm.get('bannerImage')?.value)
                  " alt="Banner Preview" class="preview-img-large" />
              </div>
            </div>
          </div>
        </div>
      </details>

      <!-- Intro Section -->
      <details class="accordion-section">
        <summary class="accordion-header">Intro Section</summary>
        <div class="accordion-content" formGroupName="intro">
          <div class="form-row">
            <div class="form-group">
              <label>Subtitle</label>
              <input pInputText formControlName="subtitle" placeholder="e.g., We Are Bakerfresh" />
            </div>
            <div class="form-group">
              <label>Title</label>
              <input pInputText formControlName="title" placeholder="e.g., we love cake" />
            </div>
          </div>

          <div class="form-group full">
            <label>Paragraph 1</label>
            <p-editor formControlName="paragraph1" [style]="{ height: '150px' }"
              placeholder="Enter first paragraph..."></p-editor>
          </div>
          <div class="form-group full">
            <label>Paragraph 2</label>
            <p-editor formControlName="paragraph2" [style]="{ height: '150px' }"
              placeholder="Enter second paragraph..."></p-editor>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Signature Image</label>
              <input type="file" accept="image/*" (change)="onFileSelected($event, 'introSignature')" />
              <small class="text-muted d-block">Recommended: 200x80 px</small>
              <div *ngIf="
                  imagePreviews['introSignature'] ||
                  aboutForm.get('intro.signatureImage')?.value
                " class="preview-container mt-2">
                <img [src]="
                    imagePreviews['introSignature'] ||
                    buildImageUrl(aboutForm.get('intro.signatureImage')?.value)
                  " alt="Signature" class="preview-img" />
              </div>
            </div>
            <div class="form-group">
              <label>Main Image</label>
              <input type="file" accept="image/*" (change)="onFileSelected($event, 'introImage')" />
              <small class="text-muted d-block">Recommended: 570x670 px</small>
              <div *ngIf="
                  imagePreviews['introImage'] ||
                  aboutForm.get('intro.image')?.value
                " class="preview-container mt-2">
                <img [src]="
                    imagePreviews['introImage'] ||
                    buildImageUrl(aboutForm.get('intro.image')?.value)
                  " alt="Intro image" class="preview-img" />
              </div>
            </div>
          </div>
        </div>
      </details>

      <!-- CTA Section -->
      <details class="accordion-section">
        <summary class="accordion-header">Call to Action</summary>
        <div class="accordion-content" formGroupName="cta">
          <div class="form-group full">
            <label>YouTube Video URL</label>
            <input pInputText formControlName="videoUrl" placeholder="https://www.youtube.com/watch?v=..." />
            <small class="text-muted d-block">Formats: youtube.com/watch?v=ID, youtu.be/ID,
              youtube.com/embed/ID</small>
          </div>
          <div class="form-group full">
            <label>Background Image</label>
            <input type="file" accept="image/*" (change)="onFileSelected($event, 'ctaBg')" />
            <small class="text-muted d-block">Recommended: 1920x600 px</small>
            <div *ngIf="
                imagePreviews['ctaBg'] ||
                aboutForm.get('cta.backgroundImage')?.value
              " class="preview-container mt-2">
              <img [src]="
                  imagePreviews['ctaBg'] ||
                  buildImageUrl(aboutForm.get('cta.backgroundImage')?.value)
                " alt="CTA background" class="preview-img" />
            </div>
          </div>
        </div>
      </details>

      <!-- Open Section -->
      <details class="accordion-section">
        <summary class="accordion-header">We Are Open</summary>
        <div class="accordion-content" formGroupName="open">
          <div class="form-row">
            <div class="form-group">
              <label>Subtitle</label>
              <input pInputText formControlName="subtitle" placeholder="e.g., Bakerfresh Time" />
            </div>
            <div class="form-group">
              <label>Title</label>
              <input pInputText formControlName="title" placeholder="e.g., we are open" />
            </div>
          </div>
          <div class="form-group full">
            <label>Description</label>
            <p-editor formControlName="text" [style]="{ height: '150px' }"
              placeholder="Enter description..."></p-editor>
          </div>
          <div class="form-group full">
            <label>Image</label>
            <input type="file" accept="image/*" (change)="onFileSelected($event, 'openImage')" />
            <small class="text-muted d-block">Recommended: 370x450 px</small>
            <div *ngIf="
                imagePreviews['openImage'] || aboutForm.get('open.image')?.value
              " class="preview-container mt-2">
              <img [src]="
                  imagePreviews['openImage'] ||
                  buildImageUrl(aboutForm.get('open.image')?.value)
                " alt="Open section image" class="preview-img" />
            </div>
          </div>
        </div>
      </details>

      <!-- Schedule -->
      <details class="accordion-section">
        <summary class="accordion-header">Opening Schedule</summary>
        <div class="accordion-content">
          <div class="form-row" formGroupName="schedule">
            <div class="form-group">
              <label>Mon - Fri</label>
              <input pInputText formControlName="monFri" placeholder="e.g., 9:00 am - 9:00 pm" />
            </div>
            <div class="form-group">
              <label>Sat - Sun</label>
              <input pInputText formControlName="satSun" placeholder="e.g., 10:00 am - 10:00 pm" />
            </div>
          </div>
        </div>
      </details>

      <!-- Team Section -->
      <details class="accordion-section">
        <summary class="accordion-header">Team Members</summary>
        <div class="accordion-content">
          <div class="mb-2">
            <button type="button" pButton icon="pi pi-plus" label="Add Member" class="p-button-sm p-button-primary"
              (click)="addTeamMember()"></button>
          </div>
          <div formArrayName="team">
            <div *ngFor="let member of teamMembers.controls; let i = index" [formGroupName]="i" class="card mb-3 p-3">
              <div class="flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Member #{{ i + 1 }}</h5>
                <button type="button" pButton icon="pi pi-trash" class="p-button-text p-button-danger p-button-sm"
                  (click)="removeTeamMember(i)"></button>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Name</label>
                  <input pInputText formControlName="name" />
                </div>
                <div class="form-group">
                  <label>Position</label>
                  <input pInputText formControlName="position" />
                </div>
              </div>
              <div class="form-group full">
                <label>Profile Image</label>
                <input type="file" accept="image/*" (change)="onFileSelected($event, 'team', i)" />
                <small class="text-muted d-block">Recommended: 370x450 px</small>
                <div *ngIf="
                    selectedImages['team' + i] || member.get('image')?.value
                  " class="preview-container mt-2">
                  <img [src]="
                      imagePreviews['team' + i] ||
                      buildImageUrl(member.get('image')?.value)
                    " alt="Team member" class="preview-img" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Facebook</label>
                  <input pInputText formControlName="facebook" placeholder="Facebook URL" />
                </div>
                <div class="form-group">
                  <label>Zalo</label>
                  <input pInputText formControlName="zalo" placeholder="Zalo phone or URL" />
                </div>
                <div class="form-group">
                  <label>LinkedIn</label>
                  <input pInputText formControlName="linkedin" placeholder="LinkedIn URL" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </details>

      <!-- Testimonials -->
      <details class="accordion-section">
        <summary class="accordion-header">Testimonials</summary>
        <div class="accordion-content">
          <div class="mb-2">
            <button type="button" pButton icon="pi pi-plus" label="Add Testimonial" class="p-button-sm p-button-primary"
              (click)="addTestimonial()"></button>
          </div>
          <div formArrayName="testimonials">
            <div *ngFor="let testimonial of testimonials.controls; let i = index" [formGroupName]="i"
              class="card mb-3 p-3">
              <div class="flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Testimonial #{{ i + 1 }}</h5>
                <button type="button" pButton icon="pi pi-trash" class="p-button-text p-button-danger p-button-sm"
                  (click)="removeTestimonial(i)"></button>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Name</label>
                  <input pInputText formControlName="name" />
                </div>
                <div class="form-group">
                  <label>Position</label>
                  <input pInputText formControlName="position" />
                </div>
              </div>
              <div class="form-group full">
                <label>Content</label>
                <p-editor formControlName="content" [style]="{ height: '150px' }"
                  placeholder="Enter testimonial..."></p-editor>
              </div>
              <div class="form-group full">
                <label>Profile Image</label>
                <input type="file" accept="image/*" (change)="onFileSelected($event, 'testimonial', i)" />
                <small class="text-muted d-block">Recommended: 100x100 px</small>
                <div *ngIf="
                    selectedImages['testimonial' + i] ||
                    testimonial.get('image')?.value
                  " class="preview-container mt-2">
                  <img [src]="
                      imagePreviews['testimonial' + i] ||
                      buildImageUrl(testimonial.get('image')?.value)
                    " alt="Testimonial" class="preview-img" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </details>

      <!-- Brand Images -->
      <details class="accordion-section">
        <summary class="accordion-header">Brand Images / Partner Logos</summary>
        <div class="accordion-content">
          <div class="form-group full">
            <label>Upload Logos</label>
            <input type="file" accept="image/*" multiple (change)="onMultipleFilesSelected($event, 'brands')" />
            <small class="text-muted d-block">Recommended: 300x300 px (PNG with transparent background)</small>
          </div>
          <div class="row g-3" formArrayName="brandImages">
            <div *ngFor="let image of brandImages.controls; let i = index" class="col-md-3">
              <div class="position-relative">
                <img [src]="buildImageUrl(image.value)" class="img-thumbnail" alt="Brand logo"
                  style="max-height: 100px; object-fit: contain; width: 100%" />
                <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0"
                  (click)="removeBrandImage(i)">
                  Ã—
                </button>
              </div>
            </div>
          </div>
        </div>
      </details>

      <!-- Section Titles -->
      <details class="accordion-section">
        <summary class="accordion-header">Section Titles & Styling</summary>
        <div class="accordion-content">
          <div class="form-row">
            <div class="form-group" formGroupName="teamSection">
              <label>Team Title</label>
              <input pInputText formControlName="title" placeholder="e.g., Our Chef" />
            </div>
            <div class="form-group" formGroupName="testimonialsSection">
              <label>Testimonials Title</label>
              <input pInputText formControlName="title" placeholder="e.g., Customers Review" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group" formGroupName="testimonialsSection">
              <label>Testimonials Background</label>
              <input type="color" formControlName="bgColor" style="height: 48px; width: 100%" />
            </div>
          </div>
        </div>
      </details>

      <!-- Actions -->
      <div class="flex justify-content-end mt-4">
        <button pButton type="submit" class="p-button-primary" [disabled]="aboutForm.invalid || isUploading">
          {{ isUploading ? "Saving..." : "Save Changes" }}
        </button>
      </div>
    </form>
  </div>
</div>