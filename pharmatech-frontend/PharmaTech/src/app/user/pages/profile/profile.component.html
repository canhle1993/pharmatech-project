<!-- Breadcrumb Section Start -->
<div class="breadcrumb" data-bg-image="assets/images/bg/profileTop.png">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="breadcrumb_content">
          <h1 class="breadcrumb_title">Profile</h1>
          <ul class="breadcrumb_list">
            <li><a href="index.html">Home</a></li>
            <li>Profile</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Breadcrumb Section End -->

<div class="container-xxl flex-grow-1 container-p-y" *ngIf="account">
  <div class="row pt-3">
    <div class="col-md-12">
      <div class="card mb-4">
        <h5 class="card-header">Profile</h5>

        <!-- Avatar -->
        <div class="card-body">
          <div class="d-flex align-items-start align-items-sm-center gap-4">
            <img
              [src]="
                account?.photo ? account.photo : 'assets/images/no-image.jpg'
              "
              alt="user-avatar"
              class="d-block rounded"
              height="100"
              width="100"
              id="uploadedAvatar"
            />
            <div>
              <h5 class="mb-0">{{ account.name }}</h5>
              <p class="text-muted mb-0">{{ account.email }}</p>
              <p class="text-muted mb-0">
                <strong>Status:</strong>
                <span
                  [class.text-success]="account.is_active"
                  [class.text-danger]="!account.is_active"
                >
                  {{ account.is_active ? "Active" : "Inactive" }}
                </span>
              </p>
            </div>

            <div class="button-wrapper">
              <button type="button" data-inline="true" (click)="toggleEdit()">
                <i class="bx bx-edit"></i>
                {{ isEditing ? "Cancel" : "Edit" }}
              </button>

              <label
                *ngIf="isEditing"
                for="upload-photo"
                style="
                  background-color: #fd8d0d;
                  color: white;
                  padding: 0.4rem 1rem;
                  border-radius: 0.25rem;
                  margin-right: 0.5rem;
                  margin-bottom: 1rem;
                  display: inline-block;
                  cursor: pointer;
                "
                tabindex="0"
              >
                <span class="d-none d-sm-block">Upload new photo</span>
                <i class="bx bx-upload d-block d-sm-none"></i>
                <input
                  type="file"
                  id="upload-photo"
                  hidden
                  accept="image/png, image/jpeg"
                  (change)="onPhotoSelected($event)"
                />
              </label>
            </div>
          </div>
        </div>

        <hr class="my-0" />

        <!-- Account Info -->
        <div class="card-body">
          <!-- âœ… Äáº·t ngSubmit Ä‘Ãºng vá»‹ trÃ­ -->
          <form
            id="formAccountSettings"
            (ngSubmit)="saveChanges()"
            #formRef="ngForm"
          >
            <div class="row">
              <!-- Basic Info -->
              <div class="mb-3 col-md-6">
                <label class="form-label">Full Name</label>
                <input
                  class="form-control"
                  type="text"
                  [(ngModel)]="account.name"
                  name="name"
                  [readonly]="!isEditing"
                />
              </div>

              <div class="mb-3 col-md-6">
                <label class="form-label">Phone</label>
                <input
                  class="form-control"
                  type="text"
                  [(ngModel)]="account.phone"
                  name="phone"
                  [readonly]="!isEditing"
                />
              </div>

              <div class="mb-3 col-md-6">
                <label class="form-label">Address</label>
                <input
                  class="form-control"
                  type="text"
                  [(ngModel)]="account.address"
                  name="address"
                  [readonly]="!isEditing"
                />
              </div>

              <div class="mb-3 col-md-6">
                <label class="form-label">Gender</label>

                <!-- ðŸ”¹ Khi khÃ´ng edit: chá»‰ hiá»ƒn thá»‹ text -->
                <input
                  *ngIf="!isEditing"
                  class="form-control"
                  type="text"
                  [value]="account.gender || '-'"
                  readonly
                />

                <!-- ðŸ”¹ Khi Ä‘ang edit: hiá»ƒn thá»‹ radio chá»n -->
                <div
                  *ngIf="isEditing"
                  class="d-flex align-items-center flex-wrap gap-3 mt-1"
                >
                  <div class="form-check form-check-inline mb-0">
                    <input
                      class="form-check-input"
                      type="radio"
                      id="male"
                      name="gender"
                      value="Male"
                      [(ngModel)]="account.gender"
                    />
                    <label class="form-check-label" for="male">Male</label>
                  </div>

                  <div class="form-check form-check-inline mb-0">
                    <input
                      class="form-check-input"
                      type="radio"
                      id="female"
                      name="gender"
                      value="Female"
                      [(ngModel)]="account.gender"
                    />
                    <label class="form-check-label" for="female">Female</label>
                  </div>

                  <div class="form-check form-check-inline mb-0">
                    <input
                      class="form-check-input"
                      type="radio"
                      id="other"
                      name="gender"
                      value="Other"
                      [(ngModel)]="account.gender"
                    />
                    <label class="form-check-label" for="other">Other</label>
                  </div>
                </div>
              </div>

              <div class="mb-3 col-md-6" *ngIf="!isEditing">
                <label class="form-label">Username</label>
                <input
                  class="form-control"
                  type="text"
                  [value]="account.username"
                  readonly
                />
              </div>

              <div class="mb-3 col-md-6" *ngIf="!isEditing">
                <label class="form-label">Email</label>
                <input
                  class="form-control"
                  type="text"
                  [value]="account.email"
                  readonly
                />
              </div>

              <!-- Education -->
              <div class="col-12 mt-4">
                <h6 class="text-primary">ðŸŽ“ Education</h6>
                <hr class="mt-1 mb-3" />
              </div>

              <div class="mb-3 col-md-4">
                <label class="form-label">Degree</label>
                <input
                  class="form-control"
                  type="text"
                  [(ngModel)]="account.education.degree"
                  name="education_degree"
                  [readonly]="!isEditing"
                />
              </div>

              <div class="mb-3 col-md-4">
                <label class="form-label">University</label>
                <input
                  class="form-control"
                  type="text"
                  [(ngModel)]="account.education.university"
                  name="education_university"
                  [readonly]="!isEditing"
                />
              </div>

              <div class="mb-3 col-md-4">
                <label class="form-label">Graduation Year</label>
                <input
                  class="form-control"
                  type="number"
                  [(ngModel)]="account.education.graduation_year"
                  name="education_graduation_year"
                  [readonly]="!isEditing"
                />
              </div>

              <!-- Experience -->
              <div class="col-12 mt-4">
                <h6 class="text-primary">ðŸ’¼ Experience</h6>
                <hr class="mt-1 mb-3" />
              </div>

              <div class="mb-3 col-md-4">
                <label class="form-label">Company</label>
                <input
                  class="form-control"
                  type="text"
                  [(ngModel)]="account.experience.company"
                  name="experience_company"
                  [readonly]="!isEditing"
                />
              </div>

              <div class="mb-3 col-md-4">
                <label class="form-label">Position</label>
                <input
                  class="form-control"
                  type="text"
                  [(ngModel)]="account.experience.position"
                  name="experience_position"
                  [readonly]="!isEditing"
                />
              </div>

              <div class="mb-3 col-md-4">
                <label class="form-label">Years</label>
                <input
                  class="form-control"
                  type="number"
                  [(ngModel)]="account.experience.years"
                  name="experience_years"
                  [readonly]="!isEditing"
                />
              </div>

              <!-- Resume -->
              <div class="col-12 mt-4">
                <h6 class="text-primary">ðŸ“„ Resume</h6>
                <hr class="mt-1 mb-3" />

                <!-- Khi khÃ´ng edit -->
                <div *ngIf="!isEditing">
                  <a
                    *ngIf="account.resume"
                    [href]="account.resume"
                    target="_blank"
                    class="btn btn-sm btn-outline-primary"
                  >
                    <i class="bx bx-download"></i> View / Download Resume
                  </a>
                  <p *ngIf="!account.resume" class="text-muted mb-0">
                    No resume uploaded.
                  </p>
                </div>

                <!-- Khi Ä‘ang edit -->
                <div *ngIf="isEditing">
                  <input
                    type="file"
                    accept=".pdf,.jpg,.png"
                    (change)="onResumeSelected($event)"
                  />
                </div>
              </div>
            </div>

            <!-- âœ… NÃºt Save chá»‰ hiá»‡n khi Ä‘ang Edit -->
            <div class="mt-2 text-end" *ngIf="isEditing">
              <button type="submit" data-inline="true">Save changes</button>
            </div>
          </form>
        </div>
        <!-- /Account -->
      </div>
    </div>
  </div>
</div>

<p-progressSpinner
  *ngIf="loading"
  styleClass="custom-spinner"
></p-progressSpinner>
<p-toast></p-toast>
