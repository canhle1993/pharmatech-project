<!-- N√∫t AI n·ªïi (·∫©n ƒëi khi ƒëang m·ªü chat) -->
<button class="ai-btn" *ngIf="!showChat" (click)="toggleChat()">
  <img
    src="https://cdn-icons-png.flaticon.com/512/4712/4712100.png"
    width="26"
    height="26"
    alt="AI"
  />
</button>

<!-- C·ª≠a s·ªï chat: popup ho·∫∑c full-screen -->
<div
  *ngIf="showChat"
  [ngClass]="{ 'chat-window': !fullscreen, 'chat-window-full': fullscreen }"
>
  <!-- Header ki·ªÉu Material AppBar -->
  <div class="chat-header">
    <div class="chat-header-left">
      <div class="chat-title">PharmaTech AI Assistant</div>
      <div class="chat-subtitle">H·ªèi g√¨ v·ªÅ Capsule, Tablet, Career‚Ä¶ nh√©</div>
    </div>

    <div class="chat-header-actions">
      <!-- n√∫t full-screen / exit full-screen -->
      <button
        class="icon-btn"
        type="button"
        (click)="toggleFullscreen()"
        [title]="fullscreen ? 'Thu nh·ªè' : 'M·ªü to√†n m√†n h√¨nh'"
      >
        <span *ngIf="!fullscreen">‚õ∂</span>
        <span *ngIf="fullscreen">üóó</span>
      </button>

      <!-- n√∫t ƒë√≥ng -->
      <button
        class="icon-btn close-btn"
        type="button"
        (click)="toggleChat()"
        title="ƒê√≥ng"
      >
        ‚úï
      </button>
    </div>
  </div>

  <!-- Th√¢n chat -->
  <div class="chat-body">
    <div *ngFor="let msg of messages" class="msg-row">
      <!-- tin ng∆∞·ªùi d√πng -->
      <div class="msg msg-user" *ngIf="msg.from === 'user'">
        <span class="msg-text">{{ msg.text }}</span>
      </div>

      <!-- tin bot -->
      <div class="msg msg-bot" *ngIf="msg.from === 'bot'">
        <img
          class="avatar"
          src="https://cdn-icons-png.flaticon.com/512/4712/4712100.png"
          alt="Bot"
        />
        <span class="msg-text">{{ msg.text }}</span>
      </div>
    </div>

    <!-- typing indicator -->
    <div class="msg msg-bot typing" *ngIf="typing">
      <img
        class="avatar"
        src="https://cdn-icons-png.flaticon.com/512/4712/4712100.png"
        alt="Bot"
      />
      <span class="dots"></span>
    </div>
  </div>

  <!-- Input -->
  <div class="chat-input">
    <input
      type="text"
      placeholder="Nh·∫≠p c√¢u h·ªèi..."
      [(ngModel)]="userMessage"
      (keyup.enter)="sendMessage()"
    />
    <button type="button" (click)="sendMessage()">Send</button>
  </div>
</div>
